(function(e){function t(t){for(var n,i,l=t[0],r=t[1],c=t[2],d=0,p=[];d<l.length;d++)i=l[d],o[i]&&p.push(o[i][0]),o[i]=0;for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n]);u&&u(t);while(p.length)p.shift()();return a.push.apply(a,c||[]),s()}function s(){for(var e,t=0;t<a.length;t++){for(var s=a[t],n=!0,l=1;l<s.length;l++){var r=s[l];0!==o[r]&&(n=!1)}n&&(a.splice(t--,1),e=i(i.s=s[0]))}return e}var n={},o={app:0},a=[];function i(t){if(n[t])return n[t].exports;var s=n[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=e,i.c=n,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(s,n,function(t){return e[t]}.bind(null,n));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/";var l=window["webpackJsonp"]=window["webpackJsonp"]||[],r=l.push.bind(l);l.push=t,l=l.slice();for(var c=0;c<l.length;c++)t(l[c]);var u=r;a.push([0,"chunk-vendors"]),s()})({0:function(e,t,s){e.exports=s("56d7")},"034f":function(e,t,s){"use strict";var n=s("27fb"),o=s.n(n);o.a},1:function(e,t){},"27fb":function(e,t,s){},"56d7":function(e,t,s){"use strict";s.r(t);var n={};s.r(n),s.d(n,"enemies",function(){return d}),s.d(n,"players",function(){return f});var o=s("2b0e");const a=!0;function i(e,t,s){console.group("Unhandled Error!"),console.groupCollapsed("err"),console.dir(e),console.groupEnd(),console.groupCollapsed("vm"),console.dir(t),console.groupEnd(),console.groupCollapsed("info"),console.dir(s),console.groupEnd(),console.groupCollapsed("trace"),console.trace(),console.groupEnd(),console.groupEnd()}o["a"].config.productionTip=!1,o["a"].config.silent=a,o["a"].config.errorHandler=i;var l=s("2f62"),r={},c={},u={enemies:[{id:1,position:{top:{default:-120,value:-120,step:1.1},left:{default:10,value:10,step:0}},scale:{type:"max",value:.9,step:.01,min:.6,max:1.5}},{id:2,position:{top:{default:-150,value:-150,step:.2},left:{default:250,value:250,step:0}},scale:{type:"max",value:.7,step:.03,min:.8,max:1.1}},{id:3,position:{top:{default:-200,value:-200,step:.7},left:{default:100,value:100,step:0}},scale:{type:"min",value:.8,step:.01,min:.7,max:1.8}},{id:4,position:{top:{default:-200,value:-200,step:.3},left:{default:30,value:30,step:0}},scale:{type:"min",value:.7,step:.08,min:.9,max:1.4}},{id:5,position:{top:{default:-120,value:-120,step:.6},left:{default:350,value:350,step:0}},scale:{type:"min",value:.8,step:.04,min:.3,max:2.4}},{id:6,position:{top:{default:-300,value:-300,step:.9},left:{default:80,value:80,step:0}},scale:{type:"min",value:.7,step:.03,min:.4,max:1.9}}]},d={namespaced:!0,actions:r,mutations:c,state:u},p={addPlayers(e,t){let s=e.commit;s("ADD_PLAYERS",t)}},h={ADD_PLAYERS(e,t){e.players=t}},m={players:{}},f={namespaced:!0,actions:p,mutations:h,state:m};o["a"].use(l["a"]);const v=new l["a"].Store({modules:n});o["a"].store=v;var y=v,b=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"App",attrs:{"touch-action":"none",ondragstart:"return false",oncontextmenu:"return false"},on:{mousedown:e.enableScreenFull,touchstart:e.enableScreenFull}},[s("Enemies"),s("Player"),s("Players")],1)},g=[],w=s("93bf"),_=s.n(w),C=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"Enemies"},e._l(e.enemies,function(t){return s("div",{key:t.id,staticClass:"enemy",style:e.styles[t.id]})}),0)},E=[],x=(s("ac6a"),s("be94"));const k=100;var S={name:"Enemies",data(){return{styles:{}}},computed:Object(x["a"])({},Object(l["b"])("enemies",["enemies"])),mounted(){this.setStyles(),this.runLoop()},methods:{setStyles(){this.enemies.forEach(e=>{let t=e.id;this.$set(this.styles,t,{})})},runLoop(){requestAnimationFrame(this.runLoop),this.animate()},animate(){this.enemies.forEach(e=>{let t=e.id,s=e.position,n=e.scale;this.scaling(n),this.movement(s),this.screening(s),this.update({id:t,position:s,scale:n})})},scaling(e){e.value>e[e.type]?(e.type="min",e.value-=e.step):(e.type="max",e.value+=e.step)},movement(e){e.top.value+=e.top.step},screening(e){e.top.value-k>=window.innerHeight&&(e.top.value=e.top.default)},update(e){let t=e.id,s=e.position,n=s.left,o=s.top,a=e.scale;this.styles[t]={transform:`translate3d(${n.value}px, ${o.value}px, 0) scale(${a.value})`}}}},P=S,O=(s("8efe"),s("2877")),j=Object(O["a"])(P,C,E,!1,null,"74c91547",null);j.options.__file="Enemies.vue";var $=j.exports,L=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"Player"},[s("div",{staticClass:"player",style:e.style,on:{mousedown:e.mousedown,touchstart:e.touchstart}},[s("div",{staticClass:"health"},[s("div",[e._v(e._s(e.clientId))]),s("div",[e._v(e._s(e.health))])])])])},U=[],H=s("3835"),A=(s("a481"),s("8055")),I=s.n(A),Y=s("5afb"),F=s.n(Y);const X=new F.a;let M;X.addEventListener("message",e=>{let t=e.data;M(t)});const D=16,R=1e3/60;let T,q,z=0,J=0;var B={name:"Player",data(){return{clientId:-1,health:200,position:{top:260,left:200},scale:1,radius:0,shiftY:0,shiftX:0,isCrossed:!1,isHealthUpdated:!1,isPositionUpdated:!1,isScaleUpdated:!1}},computed:Object(x["a"])({},Object(l["b"])("enemies",["enemies"]),{style(){const e=this.position,t=e.left,s=e.top,n=this.scale,o=this.getHealthColor();return{transform:`translate(${t}px, ${s}px) scale(${n})`,backgroundColor:this.isCrossed?"darkred":o}}}),watch:{health(){this.isHealthUpdated=!0},position:{deep:!0,handler(){this.isPositionUpdated=!0}},scale(){this.isScaleUpdated=!0}},mounted(){M=this.hasCrossed,this.socket(),this.initial(),this.runLoop(),this.broadcast(),window.onbeforeunload=(()=>console.log("onbeforeunload"))},destroy(){cancelAnimationFrame(q),cancelAnimationFrame(T),X.terminate()},methods:{socket(){window.app.connection=I.a.connect("http://5.63.159.2:3000",{transports:["websocket"]}),window.app.connection.on("connected",e=>{let t=e.clientId,s=e.clients;console.log("connected",t),console.log("clients",s),this.$store.dispatch("players/addPlayers",s),window.app.clientId=t,this.clientId=t})},broadcast(){q=setTimeout(this.broadcast,R),this.isHealthUpdated&&(this.isHealthUpdated=!1,window.app.connection.emit("update",{type:"client",payload:{health:this.health}})),this.isPositionUpdated&&(this.isPositionUpdated=!1,window.app.connection.emit("update",{type:"client",payload:{position:this.position}})),this.isScaleUpdated&&(this.isScaleUpdated=!1,window.app.connection.emit("update",{type:"client",payload:{scale:this.scale}}))},initial(){const e=getComputedStyle(this.$root.$el),t=e.getPropertyValue("--size");z=Number(t.replace("rem",""))*D,J=z/2,this.radius=this.scale*J},mousedown(e){document.addEventListener("mousemove",this.mousemove),document.addEventListener("mouseup",this.mouseup),this.setShift(e)},mousemove(e){let t=e.clientY,s=e.clientX;const n=this.getShift(),o=n.shiftY,a=n.shiftX,i=t-o,l=s-a;this.position={top:i,left:l}},mouseup(){document.removeEventListener("mousemove",this.mousemove),document.removeEventListener("mouseup",this.mouseup)},touchstart(e){let t=Object(H["a"])(e.touches,1),s=t[0];document.addEventListener("touchmove",this.touchmove),document.addEventListener("touchend",this.touchend),this.setShift(s)},touchmove(e){let t=Object(H["a"])(e.touches,1),s=t[0];this.mousemove(s)},touchend(){document.removeEventListener("touchmove",this.touchmove),document.removeEventListener("touchend",this.touchend)},setShift(e){let t=e.target,s=e.clientY,n=e.clientX;const o=t.getBoundingClientRect(),a=o.top,i=o.left;this.shiftY=s-a,this.shiftX=n-i},getShift(){const e=this.scale-1,t=J*e,s=this.shiftY-t,n=this.shiftX-t;return{shiftY:s,shiftX:n}},runLoop(){T=requestAnimationFrame(this.runLoop),this.getIntersections()},getIntersections(){const e=this.enemies,t=this.position,s=t.top,n=t.left,o=this.radius;X.postMessage({enemies:e,y1:s,x1:n,playerRadius:o,halfSize:J})},hasCrossed(e){this.isCrossed=e.some(e=>{let t=e.isIntersected;return t}),this.isCrossed&&this.reducedHealth()},reducedHealth(){this.health>0?this.health-=1:console.info("Game Over!")},getHealthColor(){let e="";switch(!0){case this.health>150:e="hsl(120, 80%, 40%)";break;case this.health>100:e="hsl(120, 80%, 30%)";break;case this.health>50:e="hsl(120, 80%, 20%)";break;case this.health>0:e="hsl(120, 80%, 10%)";break;default:e="black"}return e}}},G=B,N=(s("5f1b"),Object(O["a"])(G,L,U,!1,null,"1342c075",null));N.options.__file="Player.vue";var V=N.exports,W=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"Players"},e._l(e.players,function(t){return s("div",{key:t.tick,staticClass:"player",style:e.getStyle(t)},[s("div",{staticClass:"health"},[s("div",[e._v("Враг")]),s("div",[e._v(e._s(t.health))])])])}),0)},K=[],Q=s("da81"),Z=s.n(Q),ee={name:"Players",computed:Object(x["a"])({},Object(l["b"])("players",["players"])),mounted(){window.app.connection.on("updates",e=>{delete e[window.app.clientId],console.log("updates",e),Object.entries(e).forEach(e=>{let t=Object(H["a"])(e,2),s=t[0],n=t[1];console.log("id, payload",s,n);const o=this.players[s];o?this.$set(this.players,s,Z()(o,n)):this.$set(this.players,s,n)})}),window.app.connection.on("disconnected",e=>{let t=e.clientId;console.log("disconnected",t),delete this.players[t]})},methods:{getStyle(e){const t=e.health,s=e.position,n=e.scale,o=e.isCrossed,a=this.getHealthColor(t);let i;return i=s?{transform:`translate(${s.left}px, ${s.top}px) scale(${n})`,backgroundColor:o?"darkred":a}:{transform:"translate(0, 0) scale(1)",backgroundColor:o?"darkred":a},i},getHealthColor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:200,t="";switch(!0){case e>150:t="hsl(120, 80%, 40%)";break;case e>100:t="hsl(120, 80%, 30%)";break;case e>50:t="hsl(120, 80%, 20%)";break;case e>0:t="hsl(120, 80%, 10%)";break;default:t="black"}return t}}},te=ee,se=(s("e5f2"),Object(O["a"])(te,W,K,!1,null,"d7eb910c",null));se.options.__file="Players.vue";var ne=se.exports,oe={name:"App",components:{Enemies:$,Player:V,Players:ne},methods:{enableScreenFull(){const e=!0;e&&_.a.enabled&&_.a.request()}}},ae=oe,ie=(s("034f"),Object(O["a"])(ae,b,g,!1,null,null,null));ie.options.__file="App.vue";var le=ie.exports;window.app={clientId:-1,connection:{}},new o["a"]({store:y,render:e=>e(le)}).$mount("#app")},"5afb":function(e,t,s){e.exports=function(){return new Worker(s.p+"b0c4a6ce01d8b950edb4.worker.js")}},"5f1b":function(e,t,s){"use strict";var n=s("7161"),o=s.n(n);o.a},7161:function(e,t,s){},"83e5":function(e,t,s){},"8efe":function(e,t,s){"use strict";var n=s("ebc7"),o=s.n(n);o.a},e5f2:function(e,t,s){"use strict";var n=s("83e5"),o=s.n(n);o.a},ebc7:function(e,t,s){}});
//# sourceMappingURL=app.ae5bf493.js.map